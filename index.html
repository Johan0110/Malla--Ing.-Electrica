<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Curricular – Ingeniería Eléctrica UNAL</title>

<style>
body{margin:0;font-family:'Segoe UI',system-ui,sans-serif;background:#f4f6f9}
h1{text-align:center;margin:14px 0}

.top{
 display:grid;
 grid-template-columns:1fr auto 1fr;
 align-items:center;
 gap:15px;
 padding:10px 20px;
}

.stats{font-size:13px;line-height:1.6}

button{
 padding:6px 14px;border:none;border-radius:8px;
 cursor:pointer;background:#e74c3c;color:white
}

.legend{display:flex;gap:15px;font-size:13px;justify-content:flex-end}
.legend span{display:flex;align-items:center;gap:6px}
.box{width:14px;height:14px;border-radius:4px}

.fund{background:#e6d9f5}
.disc{background:#d3f3ec}
.libre{background:#ffe8b8}
.total{background:#d6eaf8}

.progress-section{
 padding:0 20px 10px;
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:12px;
}

.progress-card{
 background:white;
 border-radius:12px;
 padding:10px;
 box-shadow:0 4px 10px rgba(0,0,0,.08);
 font-size:12px;
}

.progress-bar{
 height:10px;
 background:#eee;
 border-radius:8px;
 overflow:hidden;
 margin-top:6px;
}

.progress-fill{
 height:100%;
 width:0%;
 transition:width .3s;
}

.container{
 display:grid;
 grid-template-columns:repeat(10,1fr);
 gap:12px;padding:15px
}

.semester{
 background:#fff;border-radius:14px;
 box-shadow:0 4px 10px rgba(0,0,0,.08);
 padding:10px
}

.semester h2{text-align:center;font-size:14px;margin:6px 0 10px}

.course{
 border-radius:10px;padding:8px;margin-bottom:8px;
 font-size:12px;cursor:pointer;transition:.2s;
 position:relative
}
.course:hover{transform:scale(1.02)}
.course.approved{text-decoration:line-through;font-weight:600}

.course.locked{
 opacity:.45;
 cursor:not-allowed
}
.course.locked:hover::after{
 content:attr(data-tip);
 position:absolute;left:0;top:105%;
 background:#333;color:#fff;font-size:11px;
 padding:5px 7px;border-radius:6px;white-space:nowrap
}

.footer{text-align:center;font-size:12px;color:#777;margin:15px}
</style>
</head>

<body>

<h1>Malla Curricular Interactiva – Ingeniería Eléctrica (UNAL)</h1>

<div class="top">
 <div class="stats" id="stats"></div>
 <button onclick="resetProgress()">Restablecer</button>
 <div class="legend">
   <span><div class="box fund"></div>Fundamentación</span>
   <span><div class="box disc"></div>Disciplinar</span>
   <span><div class="box libre"></div>Libre</span>
 </div>
</div>

<div class="progress-section">
 <div class="progress-card">
  Fundamentación <b id="pf">0%</b>
  <div class="progress-bar"><div class="progress-fill fund" id="pfb"></div></div>
 </div>
 <div class="progress-card">
  Disciplinar <b id="pd">0%</b>
  <div class="progress-bar"><div class="progress-fill disc" id="pdb"></div></div>
 </div>
 <div class="progress-card">
  Libre Elección <b id="pl">0%</b>
  <div class="progress-bar"><div class="progress-fill libre" id="plb"></div></div>
 </div>
 <div class="progress-card">
  Total <b id="pt">0%</b>
  <div class="progress-bar"><div class="progress-fill total" id="ptb"></div></div>
 </div>
</div>

<div class="container" id="malla"></div>

<div class="footer">
 Clic para aprobar · Barras de progreso automáticas · Guardado local
</div>

<script>
const data=[
// (MISMA DATA QUE YA TENÍAS, NO SE TOCÓ)
{sem:1,id:'1000004',name:'Cálculo Diferencial',cred:4,comp:'fund'},
{sem:1,id:'1000008',name:'Geometría Vectorial y Analítica',cred:4,comp:'fund'},
{sem:1,id:'3009531',name:'Introducción a la Ingeniería Eléctrica',cred:2,comp:'disc'},
{sem:1,id:'LE1',name:'Libre Elección',cred:3,comp:'libre'},
{sem:1,id:'LE2',name:'Libre Elección',cred:3,comp:'libre'},
// (resto de semestres omitido aquí por brevedad,
// en tu archivo DEBE quedar exactamente igual que antes)
];

let approved=JSON.parse(localStorage.getItem('ie_aprobadas')||'[]');
const malla=document.getElementById('malla');
const stats=document.getElementById('stats');

function comp(type){
 const total=data.filter(c=>c.comp===type).reduce((s,c)=>s+c.cred,0);
 const done=data.filter(c=>c.comp===type && approved.includes(c.id))
               .reduce((s,c)=>s+c.cred,0);
 return {done,total,p:total?Math.round(done/total*100):0};
}

function render(){
 malla.innerHTML='';
 const f=comp('fund'), d=comp('disc'), l=comp('libre');
 const totalDone=f.done+d.done+l.done;
 const totalAll=data.reduce((s,c)=>s+c.cred,0);
 const totalP=Math.round(totalDone/totalAll*100);

 stats.innerHTML=`
 <b>Fundamentación:</b> ${f.done}/${f.total} (${f.p}%)<br>
 <b>Disciplinar:</b> ${d.done}/${d.total} (${d.p}%)<br>
 <b>Libre:</b> ${l.done}/${l.total} (${l.p}%)<br>
 <b>Total:</b> ${totalDone} créditos
 `;

 pf.textContent=f.p+'%'; pfb.style.width=f.p+'%';
 pd.textContent=d.p+'%'; pdb.style.width=d.p+'%';
 pl.textContent=l.p+'%'; plb.style.width=l.p+'%';
 pt.textContent=totalP+'%'; ptb.style.width=totalP+'%';

 for(let s=1;s<=10;s++){
  const col=document.createElement('div');
  col.className='semester';
  col.innerHTML=`<h2>Semestre ${s}</h2>`;

  data.filter(c=>c.sem===s).forEach(c=>{
   let locked=false,tip='';
   if(c.req && !c.req.every(r=>approved.includes(r))){
    locked=true; tip='Faltan prerrequisitos';
   }
   if(c.fundPercent && f.p<c.fundPercent){
    locked=true; tip=`Requiere ${c.fundPercent}% de Fundamentación`;
   }

   const d=document.createElement('div');
   d.className=`course ${c.comp} ${approved.includes(c.id)?'approved':''} ${locked?'locked':''}`;
   d.innerHTML=`<b>${c.name}</b><br><small>${c.cred} créditos</small>`;
   if(locked) d.dataset.tip=tip;

   d.onclick=()=>{
    if(locked) return;
    approved.includes(c.id)
      ? approved=approved.filter(x=>x!==c.id)
      : approved.push(c.id);
    localStorage.setItem('ie_aprobadas',JSON.stringify(approved));
    render();
   };

   col.appendChild(d);
  });
  malla.appendChild(col);
 }
}

function resetProgress(){
 if(confirm('¿Restablecer todo el progreso?')){
  approved=[];
  localStorage.removeItem('ie_aprobadas');
  render();
 }
}

render();
</script>
</body>
</html>
